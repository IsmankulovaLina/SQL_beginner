Для выполенения данных заданий создайте базу данных по образцу из папки Team01/materials/model.sql

## Упражнение 00 — Классовое хранилище данных (DWH)

Пожалуйста, напишите SQL-запрос, который возвращает общий объем (сумму всех денег) транзакций из баланса пользователя, агрегированный по пользователю и типу баланса. Обратите внимание, что все данные должны быть обработаны, включая данные с аномалиями. Ниже приведена таблица с колонками результата и соответствующей формулой вычисления.

| Output Column | Formula (pseudocode) |
| ------ | ------ |
| name | источник: user.name если user.name равно NULL, тогда возвращайте значение `not defined` |
| lastname | источник: user.lastname если user.lastname равно NULL, тогда возвращайте значение `not defined` |
| type | источник: balance.type | 
| volume | источник: balance.money — необходимо суммировать все "движения" денег | 
| currency_name | источник: currency.name если currency.name равно NULL, тогда возвращайте значение `not defined` | 
| last_rate_to_usd | источник: currency.rate_to_usd. взять последний курс currency.rate_to_usd для соответствующей валюты; если currency.rate_to_usd равно NULL, тогда возвращайте 1 | 
| total_volume_in_usd | источник: volume и last_rate_to_usd. выполнить умножение объема на последний курс к USD |

Посмотрите пример выходных данных ниже. Отсортируйте результат по имени пользователя по убыванию, а затем по фамилии пользователя и типу баланса — по возрастанию.

| name | lastname | type | volume | currency_name | last_rate_to_usd | total_volume_in_usd |
| ------ | ------ | ------ | ------ | ------ | ------ | ------ |
| Петр | not defined | 2 | 203 | not defined | 1 | 203 |
| Иван | Иванов | 1 | 410 | EUR | 0.9 | 369 |
| ... | ... | ... | ... | ... | ... | ... |

## Упражнение 01 — Детализированный запрос

Прежде чем углубляться в эту задачу, выполните следующие инструкции INSERT.

`insert into currency values (100, 'EUR', 0.85, '2022-01-01 13:29');`  
`insert into currency values (100, 'EUR', 0.79, '2022-01-08 13:29');`

Пожалуйста, напишите SQL-запрос, который возвращает всех пользователей и все транзакции по балансу (в этом задании игнорируйте валюты без ключа в таблице `Currency`) с названием валюты и рассчитанной стоимостью валюты в USD на следующий день.

Ниже приведена таблица с колонками результата и соответствующей формулой вычисления.

| Output Column | Formula (pseudocode) |
| ------ | ------ |
| name | источник: user.name если user.name равно NULL, тогда возвращайте значение `not defined` |
| lastname | источник: user.lastname если user.lastname равно NULL, тогда возвращайте значение `not defined` |
| currency_name | источник: currency.name |
| currency_in_usd | источники: currency.rate_to_usd, currency.updated, balance.updated. Посмотрите графическую интерпретацию формулы ниже.| 

- Нужно найти ближайший курс `rate_to_usd` валюты в прошлом (t1).  
- Если t1 пустой (нет курсов в прошлом), тогда найти ближайший курс `rate_to_usd` валюты в будущем (t2).  
- Использовать курс t1 или t2 для расчета стоимости валюты в USD.

Посмотрите пример выходных данных ниже. Отсортируйте результат по имени пользователя по убыванию и затем по фамилии пользователя и названию валюты — по возрастанию.

| name   | lastname   | currency_name   | currency_in_usd |
|--------|------------|-----------------|-----------------|
| Иван   | Иванов     | EUR             | 150.1           |
| Иван   | Иванов     | EUR             | 17              |
| ...    | ...        | ...             | ...             |
